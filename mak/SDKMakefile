include $(PEGASUS_ROOT)/mak/config.mak
include $(PEGASUS_ROOT)/mak/commands.mak

ifndef PEGASUS_STAGING_DIR
   PEGASUS_STAGING_DIR = $(PEGASUS_HOME)/stageSDK/
endif

ifndef PEGASUS_SAMPLES_DIR
   PEGASUS_SAMPLES_DIR = samples
endif

ifndef PEGASUS_INCLUDE_DIR
   PEGASUS_INCLUDE_DIR = include
endif

ifndef PEGASUS_HTML_DIR
   PEGASUS_HTML_DIR = html
endif
   

INCLUDE_SRCPATH = $(PEGASUS_ROOT)/src

HTML_SRCPATH = $(PEGASUS_HOME)/html

CLIENT_SRCPATH1 = $(PEGASUS_ROOT)/src/SDK/samples
CLIENT_SRCPATH2 = $(PEGASUS_ROOT)/InterfaceArchive/v002001/tests/Clients

PROVIDER_SRCPATH1 = $(PEGASUS_ROOT)/src/SDK/samples/Providers
PROVIDER_SRCPATH2 = $(PEGASUS_ROOT)/src/Providers/sample
PROVIDER_SRCPATH3 = $(PEGASUS_ROOT)/InterfaceArchive/v002001/tests/Providers

INCLUDEFILES = \
   Pegasus/Client/CIMClientException.h \
   Pegasus/Client/CIMClient.h \
   Pegasus/Client/Linkage.h \
   Pegasus/Common/Array.h \
   Pegasus/Common/ArrayInter.h \
   Pegasus/Common/Char16.h \
   Pegasus/Common/CIMClass.h \
   Pegasus/Common/CIMDateTime.h \
   Pegasus/Common/CIMFlavor.h \
   Pegasus/Common/CIMIndication.h \
   Pegasus/Common/CIMInstance.h \
   Pegasus/Common/CIMMethod.h \
   Pegasus/Common/CIMName.h \
   Pegasus/Common/CIMObject.h \
   Pegasus/Common/CIMObjectPath.h \
   Pegasus/Common/CIMParameter.h \
   Pegasus/Common/CIMParamValue.h \
   Pegasus/Common/CIMProperty.h \
   Pegasus/Common/CIMPropertyList.h \
   Pegasus/Common/CIMQualifierDecl.h \
   Pegasus/Common/CIMQualifier.h \
   Pegasus/Common/CIMScope.h \
   Pegasus/Common/CIMStatusCode.h \
   Pegasus/Common/CIMType.h \
   Pegasus/Common/CIMValue.h \
   Pegasus/Common/Config.h \
   Pegasus/Common/Exception.h \
   Pegasus/Common/Linkage.h \
   Pegasus/Common/OperationContext.h \
   Pegasus/Common/ResponseHandler.h \
   Pegasus/Common/SSLContext.h \
   Pegasus/Common/String.h \
   Pegasus/Common/Platform_$(PEGASUS_PLATFORM).h \
   Pegasus/Consumer/CIMIndicationConsumer.h \
   Pegasus/Consumer/Linkage.h \
   Pegasus/Provider/CIMAssociationProvider.h \
   Pegasus/Provider/CIMIndicationConsumerProvider.h \
   Pegasus/Provider/CIMIndicationProvider.h \
   Pegasus/Provider/CIMInstanceProvider.h \
   Pegasus/Provider/CIMMethodProvider.h \
   Pegasus/Provider/CIMOMHandle.h \
   Pegasus/Provider/CIMProvider.h \
   Pegasus/Provider/Linkage.h \
   Pegasus/Provider/ProviderException.h \
   Pegasus/Provider/CMPI/cmpidt.h \
   Pegasus/Provider/CMPI/cmpift.h \
   Pegasus/Provider/CMPI/cmpimacs.h \
   Pegasus/Provider/CMPI/CmpiArgs.h \
   Pegasus/Provider/CMPI/CmpiArray.h \
   Pegasus/Provider/CMPI/CmpiAssociationMI.h \
   Pegasus/Provider/CMPI/CmpiBaseMI.h \
   Pegasus/Provider/CMPI/CmpiBooleanData.h \
   Pegasus/Provider/CMPI/CmpiBroker.h \
   Pegasus/Provider/CMPI/CmpiCharData.h \
   Pegasus/Provider/CMPI/CmpiContext.h \
   Pegasus/Provider/CMPI/CmpiData.h \
   Pegasus/Provider/CMPI/CmpiDateTime.h \
   Pegasus/Provider/CMPI/CmpiEnumeration.h \
   Pegasus/Provider/CMPI/CmpiIndicationMI.h \
   Pegasus/Provider/CMPI/CmpiInstance.h \
   Pegasus/Provider/CMPI/CmpiInstanceMI.h \
   Pegasus/Provider/CMPI/CmpiIndicationMI.h \
   Pegasus/Provider/CMPI/CmpiMethodMI.h \
   Pegasus/Provider/CMPI/CmpiObject.h \
   Pegasus/Provider/CMPI/CmpiObjectPath.h \
   Pegasus/Provider/CMPI/CmpiPropertyMI.h \
   Pegasus/Provider/CMPI/CmpiProviderBase.h \
   Pegasus/Provider/CMPI/CmpiResult.h \
   Pegasus/Provider/CMPI/CmpiSelectExp.h \
   Pegasus/Provider/CMPI/CmpiStatus.h \
   Pegasus/Provider/CMPI/CmpiString.h

INCLUDEFILES += \
   Pegasus/Common/AcceptLanguages.h \
   Pegasus/Common/MessageLoader.h \
   Pegasus/Common/ContentLanguages.h \
   Pegasus/Common/LanguageElementContainer.h \
   Pegasus/Common/AcceptLanguageElement.h \
   Pegasus/Common/Formatter.h \
   Pegasus/Common/ContentLanguageElement.h \
   Pegasus/Common/LanguageElement.h  


CLIENTSRCPATH1FILES = \
   Makefile \
   mak/$(PEGASUS_PLATFORM).mak \
   mak/config.mak \
   mak/program.mak \
   mak/recurse.mak \
   mak/library.mak \
   mak/common.mak \
   Clients/Makefile \
   Clients/DefaultC++/Makefile \
   Clients/DefaultC++/EnumInstances/Makefile \
   Clients/DefaultC++/InvokeMethod/Makefile 

CLIENTSRCPATH2FILES = \
   EnumInstances/EnumInstances.cpp \
   InvokeMethod/InvokeMethod.cpp \

PROVIDERSRCPATH1FILES = \
   Makefile \
   Load/Makefile \
   DefaultC++/Makefile \
   DefaultC++/InstanceProvider/Makefile \
   DefaultC++/MethodProvider/Makefile \
   CMPI/Makefile \
   CMPI/FilesAndDirectories/Makefile \
   CMPI/FilesAndDirectories/tests/Makefile 
   
PROVIDERSRCPATH2FILES = \
   Load/CWS_FilesAndDir.mof \
   Load/CWS_FilesAndDirR.mof \
   Load/InstanceProviderR.mof \
   Load/MethodProviderR.mof \
   Load/SampleProviderSchema.mof \
   CMPI/FilesAndDirectories/tests/AssocDirNames12001.xml \
   CMPI/FilesAndDirectories/tests/AssocDirNames12001rspgood.xml \
   CMPI/FilesAndDirectories/tests/DeleteDirInstance10003.xml \
   CMPI/FilesAndDirectories/tests/DeleteDirInstance10003rspgood.xml \
   CMPI/FilesAndDirectories/tests/EnumerateDir10001.xml \
   CMPI/FilesAndDirectories/tests/EnumerateDir10001rspgood.xml \
   CMPI/FilesAndDirectories/tests/EnumerateDirNames10000.xml \
   CMPI/FilesAndDirectories/tests/EnumerateDirNames10000rspgood.xml \
   CMPI/FilesAndDirectories/tests/GetDirInstance10002.xml \
   CMPI/FilesAndDirectories/tests/GetDirInstance10002rspgood.xml \
   CMPI/FilesAndDirectories/tests/PlainFileMethodCall11001.xml \
   CMPI/FilesAndDirectories/tests/PlainFileMethodCall11001rspgood.xml \
   CMPI/FilesAndDirectories/tests/ReferenceDirNames12002.xml \
   CMPI/FilesAndDirectories/tests/ReferenceDirNames12002rspgood.xml \
   CMPI/FilesAndDirectories/CWS_Directory.c \
   CMPI/FilesAndDirectories/CWS_DirectoryContainsFile.c \
   CMPI/FilesAndDirectories/CWS_FileUtils.c \
   CMPI/FilesAndDirectories/CWS_FileUtils.h \
   CMPI/FilesAndDirectories/CWS_PlainFile.c \
   CMPI/FilesAndDirectories/cwssimdata.c \
   CMPI/FilesAndDirectories/cwstest.c \
   CMPI/FilesAndDirectories/cwsutil.c \
   CMPI/FilesAndDirectories/cwsutil.h

PROVIDERSRCPATH3FILES = \
   InstanceProvider/InstanceProvider.cpp \
   InstanceProvider/InstanceProviderMain.cpp \
   InstanceProvider/InstanceProvider.h \
   InstanceProvider/EnumerateInstancesrspgood.xml \
   InstanceProvider/EnumerateInstances.xml \
   MethodProvider/MethodProvider.cpp \
   MethodProvider/MethodProviderMain.cpp \
   MethodProvider/MethodProvider.h \
   MethodProvider/InvokeMethod.xml \
   MethodProvider/InvokeMethodrspgood.xml

error:
	@echo "Please specify an action"

stageSDK:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageINCLUDE
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageHTML
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageSAMPLES

stageINCLUDE:
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Common
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Client
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Provider
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Provider/CMPI
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Handler
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/Pegasus/Consumer
	@$(foreach i, $(INCLUDEFILES), $(COPY) $(INCLUDE_SRCPATH)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR)/$(i);)

createPlatformFile:
	@$(ECHO) "ifndef PEGASUS_PROVIDER_LIB_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_PROVIDER_LIB_DIR = $(PEGASUS_PROVIDER_LIB_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "ifndef PEGASUS_DEST_LIB_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_DEST_LIB_DIR = $(PEGASUS_DEST_LIB_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "ifndef PEGASUS_INCLUDE_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_INCLUDE_DIR = $(PEGASUS_INCLUDE_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "ifndef PEGASUS_MOF_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_MOF_DIR = $(PEGASUS_MOF_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "ifndef PEGASUS_SAMPLES_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_SAMPLES_DIR = $(PEGASUS_SAMPLES_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "ifndef PEGASUS_BIN_DIR" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "   PEGASUS_BIN_DIR = $(PEGASUS_BIN_DIR)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(ECHO) "" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak
	@$(CAT) $(CLIENT_SRCPATH1)/mak/$(PEGASUS_PLATFORM).mak  >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak

createConfigFile:
	@$(ECHO) "ifndef PEGASUS_PLATFORM" > $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "   PEGASUS_PLATFORM = $(PEGASUS_PLATFORM)" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "endif" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "" >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(CAT)  $(PEGASUS_ROOT)/src/SDK/samples/mak/config.mak >> $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak/config.mak

stageSAMPLES:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f commands.mak cimstop_IgnoreError
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/mak
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Clients/DefaultC++/EnumInstances
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Clients/DefaultC++/InvokeMethod
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/Load
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/DefaultC++/InstanceProvider
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/DefaultC++/MethodProvider
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/CMPI/FilesAndDirectories/tests
	@$(foreach i, $(CLIENTSRCPATH1FILES), $(COPY) $(CLIENT_SRCPATH1)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/$(i);)
	@$(foreach i, $(CLIENTSRCPATH2FILES), $(COPY) $(CLIENT_SRCPATH2)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Clients/DefaultC++/$(i);)
	@$(foreach i, $(PROVIDERSRCPATH1FILES), $(COPY) $(PROVIDER_SRCPATH1)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/$(i);)
	@$(foreach i, $(PROVIDERSRCPATH2FILES), $(COPY) $(PROVIDER_SRCPATH2)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/$(i);)
	@$(foreach i, $(PROVIDERSRCPATH3FILES), $(COPY) $(PROVIDER_SRCPATH3)/$(i) $(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/DefaultC++/$(i);)
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile createConfigFile
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile createPlatformFile

stageHTML:
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_HTML_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)$(PEGASUS_HTML_DIR)
	@$(MAKE) --directory=$(PEGASUS_ROOT)/doc/SDK -f Makefile PEGASUS_HTML_DIR=$(PEGASUS_STAGING_DIR)$(PEGASUS_HTML_DIR) buildDoc_ContinueOnError

removeSampleProviderNamespace:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f commands.mak cimstop_IgnoreError
	@$(ECHO) +++++ Removing existing repository named root#SampleProvider 
	@$(RMREPOSITORY) $(REPOSITORY_ROOT)/root\#SampleProvider
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f commands.mak cimstart

buildSDK:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i deregisterproviders
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i removeSampleProviderNamespace
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR) -f Makefile clean \
             PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR) \
             PEGASUS_PROVIDER_LIB_DIR=$(PEGASUS_HOME)/lib
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR) -f Makefile all \
             PEGASUS_PROVIDER_LIB_DIR=$(PEGASUS_HOME)/lib PEGASUS_INCLUDE_DIR=$(PEGASUS_STAGING_DIR)$(PEGASUS_INCLUDE_DIR) \
             PEGASUS_DEST_LIB_DIR=$(PEGASUS_HOME)/lib PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/Load -f Makefile createrepository \
             PEGASUS_MOF_DIR=$(PEGASUS_ROOT)/Schemas PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i registerproviders PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

deregisterproviders:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/Load -f Makefile deregisterproviders \
             PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

registerproviders:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)/Providers/Load -f Makefile registerproviders \
             PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

testSDK:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR) -f Makefile  tests \
             PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)$(PEGASUS_SAMPLES_DIR)
