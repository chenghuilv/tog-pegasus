###############################################################################
##
## Makefile for Pegasus CIMOM
##
## NOTE: Makefile needs to be executed from the parent directory of 
## pegasus directory because the path settings are relative and this
## Makefile may remove and recheckout the pegasus source tree.
##
## Options:
##      cleanbuild - Removes the existing pegasus directory contents, performs
##                   checkout, build and runs tests. 
##      rebuild    - Rebuild and execute tests.
## 
###############################################################################

include $(PEGASUS_ROOT)/mak/config.mak
include $(PEGASUS_ROOT)/mak/commands.mak

TESTS = prestarttests poststarttests

ifeq ($(DYNAMIC_SOCKSIFY),TRUE)
  CVS = socksify cvs
else
  CVS = cvs
endif

error: 
	@ echo "Specify desired makefile option (i.e., cleanbuild, rebuild)"

cleanbuild: removeall recheckout buildmu all $(TESTS) 

recheckout: removeall checkout

removeall:
	$(REMOVE_PEGASUS_DIRECTORY)

checkout:
	$(CVS) checkout -P pegasus

rebuild: clean buildmu all tests

rebuild-notest: clean buildmu all

build: all tests

build-notest: all

clean:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile clean

buildmu:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile buildmu

all:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile all

doc:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile doc

repositoryServer: 
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile repositoryServer

prestarttests: 
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile prestarttests

poststarttests:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile poststarttests

tests:
	$(MAKE) --directory=$(PEGASUS_ROOT) -f TestMakefile tests
